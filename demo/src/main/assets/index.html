<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <script src="./turf.min.js"></script>
</head>
<body>
</body>
<script>
    /*@ points [[117,36],[117,37],[117,38],[117,39],[118,40]]
    * @ radius 缓冲区半径*/
    function getBufferPoint(object) {
        //object=JSON.parse(object);
        const parse = (arr) => {
            var buffered = [];
            for (var i = 0; i < arr.length; i++) {
                buffered = buffered.concat(arr[i]);
            }
            return buffered
        }
        let _points = []
        for (let i = 0; i < object.points.length; i++) {
            _points.push([object.points[i].lon, object.points[i].lat])
        }
        let _turfPositions = turf.lineString(_points);
        let returnArr = {points: [], radius: "3"};
        let bufferPoint = parse(turf.buffer(_turfPositions, object.radius, {units: 'kilometers'}).geometry.coordinates[0]);
        for (let i = 0; i < bufferPoint.length; i += 2) {
            returnArr.points.push({lon: bufferPoint[i], lat: bufferPoint[i + 1]})
        }
        return returnArr
        //JSON.stringify(returnArr)
    }
    /* 使用
    let pointArr=getBufferPoint([[117,36],[117,37],[117,38],[117,39],[118,40]],3)
    console.log(pointArr);
    */
    function test(json, lat, lon) {
        return json + lat + lon
    }
    /*-------------------------飞机适航区判断----------------------*/
    function initFunction(){
        return true
    }
    let polygons=[]
    /*初始化缓冲区-参数json*/
    function initBufferPolygon(object){
        for (let i=0;i<object.length;i++){
            if (object[i].points.length===1){
                let center = [object[i].points[0].lon, object[i].points[0].lat];
                let radius = object[i].radius;
                let options = {steps: 30, units: 'kilometers'};
                let circlePolygon = turf.circle(center, radius, options);
                polygons.push(circlePolygon);
            }
            else{
                let linepoint=[]
                for (let j=0;j<object[i].points.length;j++){
                    linepoint.push([object[i].points[j].lon,object[i].points[j].lat])
                }
                let linePolygon=turf.buffer(turf.lineString(linepoint), object[i].radius, {units: 'kilometers'})
                polygons.push(linePolygon);
            }
        }
    }
<!--    function initBufferPolygon1(object,point){-->
<!--        let polygons=[]-->
<!--        for (let i=0;i<object.length;i++){-->

<!--            if (object[i].points.length===1){-->
<!--                let center = [object[i].points[0].lon, object[i].points[0].lat];-->
<!--                let radius = object[i].radius;-->
<!--                let options = {steps: 30, units: 'kilometers'};-->
<!--                let circlePolygon = turf.circle(center, radius, options);-->
<!--                polygons.push(circlePolygon);-->
<!--            }-->

<!--            else{-->
<!--                let linepoint=[]-->
<!--                for (let j=0;j<object[i].points.length;j++){-->
<!--                    linepoint.push([object[i].points[j].lon,object[i].points[j].lat])-->
<!--                }-->
<!--                let linePolygon=turf.buffer(turf.lineString(linepoint), object[i].radius, {units: 'kilometers'})-->
<!--                polygons.push(linePolygon);-->
<!--            }-->
<!--        }-->
<!--        for (let i=0;i<polygons.length;i++){-->
<!--            if (turf.booleanPointInPolygon([point.lon,point.lat], polygons[i])){-->
<!--                return false-->
<!--            }-->
<!--        }-->
<!--        return true;-->
<!--    }-->

    /*判断飞机点是否在适航区--都不在返回true  有一个在返回false
    * @params 飞机点经纬度*/
    function pointInPolygon(point){
        for (let i=0;i<polygons.length;i++){
            if (turf.booleanPointInPolygon([point.lon,point.lat], polygons[i])){
                return false
            }
        }
        return true;
    }

    /*使用例子  删除就行了*/
    let jsondata=[
        {
            "points": [
                {
                    "lat": 34.234365,
                    "lon": 114.114124
                }
            ],
            "radius": "3",
            "id": "111"
        },
        {
            "points": [
                {
                    "lat": 34.234365,
                    "lon": 114.114124
                },
                {
                    "lat": 35.234365,
                    "lon": 115.114124
                },
                {
                    "lat": 36.234365,
                    "lon": 116.114124
                }
            ],
            "radius": "3",
            "id": "222"
        }
    ]
    let airPoint={lon:114.114124, lat:34.234365}
    initBufferPolygon(jsondata)
    let trueOrfalse=pointInPolygon(airPoint);
    console.log(trueOrfalse);
    /*-------------------------------------------------------------*/
</script>
</html>
